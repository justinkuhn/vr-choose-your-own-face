<html>
  <head>
      <title>Don't Look Back</title> 
<meta charset="UTF-8">
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>
    <script src="https://npmcdn.com/aframe-event-set-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-layout-component@3.0.1"></script>
    <script src="https://npmcdn.com/aframe-template-component@3.1.1"></script>
   <script src="https://unpkg.com/aframe-state-component@6.6.0/dist/aframe-state-component.min.js"></script>
    <script src="https://unpkg.com/aframe-proxy-event-component@2.1.0/dist/aframe-proxy-event-component.min.js"></script>
    
    <script src="js/startscreen-events.js"></script>
    <script src="js/state.js"></script>
    <script src="js/forest-events.js"></script>
    <script src="js/cabin-events.js"></script>
    <script>AFRAME.registerComponent('raycastable', {});</script>
  </head>

  <body>
    <a-scene light="defaultLightsEnabled: false"
             fog="type: linear; color: #000000; near: 1; far: 20">
       <a-assets>
          <img id="start" src="./img/start.png" crossorigin="anonymous">
          <img id="title" src="img/dontlookback.png">
          <img id="cabin" src="img/cabin.png">
          <img id="olive" src="img/olive.png">
          <img id="azure" src="img/azure.png">
          <a-mixin id="text" geometry="primitive:plane" align="center" animation="property: opacity; from: 0; to: 1; dur: 2000; startEvents: fadeIn" bind-toggle__raycastable="scene == 'motive'"></a-mixin>
          <a-asset-item id="field-glb" src="https://cdn.glitch.com/142329d1-a4be-42da-8d96-ba8339c3860c%2Ffield.glb" crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="cabin-glb" src="https://cdn.glitch.com/142329d1-a4be-42da-8d96-ba8339c3860c%2FCabin.glb" crossorigin="anonymous"></a-asset-item>
            <a-asset-item id="mushroom-gltf" src="https://cdn.glitch.com/142329d1-a4be-42da-8d96-ba8339c3860c%2FMushroom1.gltf?v=1560624630650" crossorigin="anonymous"></a-asset-item>
            <a-mixin  id="teleport" material="color: purple" teleporter geometry="primitive: dodecahedron" animation="property: rotation; to: 0 360 0; dur: 5000; from: 0 0 0; easing: linear; loop: true" scale="1 1 1"></a-mixin>
      </a-assets>
      <a-sky color="black"></a-sky>
<!--       Start Screen -->
      <a-image src="#start"  cursor-listener
               id="startButton"  position="0 -2.6 -10"
               rotation=""
               width="3" height="1.5"
               animation__out="property: material.opacity; to: 0; dur: 2000; startEvents: fadeOut"
               animation__in="property: opacity; to: 1; dur: 2000; startEvents: fadeIn"
               bind__visible="scene == 'startScreen'"
               bind-toggle__raycastable="scene == 'startScreen'">
      </a-image>

      <a-image id="titleButton" src="#title" position="0 4 -10"
               width ="10" height="3"  transparent="true"
               animation__out="property: material.opacity; to: 0; dur: 2000; startEvents: fadeOut"
               animation__in="property: opacity; to: 1; dur: 2000; startEvents: fadeIn"
               bind__visible="scene == 'startScreen'">
      </a-image>
       <a-image id="cabinButton" src="#cabin" position="-0.09876 -2 -11"
                width="8" height="8" transparent="true"
                animation__out="property: material.opacity; to: 0; dur: 2000; startEvents: fadeOut"
                animation__in="property: opacity; to: 1; dur: 2000; startEvents: fadeIn"
                bind__visible="scene == 'startScreen'">
       </a-image>


<!--      Second Screen  -->
       <a-text id="who" value="Who are you?" width="10" position="0 3 -7" align="center" opacity= "0"
               animation="property: opacity; to: 1; dur: 2000; startEvents: fadeIn"
               bind__visible="scene == 'characters'"
               ></a-text>
       <a-text id="outcastText" value="Olive" width="10" position="-4 1 -5" rotation="0 20 0" align="center" scale="0 0 0" opacity= "0"
               animation="property: opacity; to: 1; dur: 2000; startEvents: fadeIn" bind__visible="scene == 'characters'"></a-text>
       <a-text id="adventurerText" value="Azure"  width="10" position="4 1 -5" rotation="0 -20 0" align="center" scale="0 0 0" opacity= "0"
               animation="property: opacity; to: 1; dur: 2000; startEvents: fadeIn" bind__visible="scene == 'characters'"></a-text>
       <a-image id="olive-image" src="#olive" position="-4 -1 -5" rotation="0 20 0" width="4" height="4" scale="0 0 0" opacity="0"                        transparent="true" bind__visible="scene == 'characters'"
              animation="property: material.opacity; to: 1; dur: 2000; startEvents: fadeIn"
              character-handler bind-toggle__raycastable="scene == 'characters'"></a-image>
       <a-image id="azure-image" src="#azure" position="4 -1 -5"  rotation="0 -20 0" width="4" height="4" scale="0 0 0" opacity="0"                      transparent="true" bind__visible="scene == 'characters'"
              animation="property: material.opacity; to: 1; dur: 2000; startEvents: fadeIn"
              character-handler bind-toggle__raycastable="scene == 'characters'"></a-image>

<!--Motive Screen-->
               <a-text id="why" value="Why did you come here?" width="10" position="0 3 -7" 
                   mixin="text" bind__visible="scene == 'motive'"></a-text>
                <a-text id="erase" value="To forget he ever existed" width="7" position="0 0 -5" mixin="text"              
                    bind__visible="scene == 'motive'" motive-handler></a-text>
                <a-text id="zombie" value="To bring him back" width="7" position="5 0 -5" mixin="text"
                     bind__visible="scene == 'motive'" motive-handler></a-text>
                <a-text id="hologram" value="To keep him with me" width="7" position="-5 0 -5" mixin="text"               
                    bind__visible="scene == 'motive'" motive-handler></a-text>
<!--Cabin Scene-->
              <a-entity id="cabin-placeholder"
                        geometry="primitive: box; width: 10; height:10; depth: 10"
                    material="side: double; color: brown;"
                        bind__visible="scene == 'cabin'"
                        ></a-entity>
      
        <!--    lighting -->
                <a-entity light="type: ambient; color: #BBB" bind__visible="scene == 'cabin'"></a-entity>
                <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="-0.5 1 1" bind__visible="scene == 'cabin'"></a-entity>
        <!--    book    -->
              <a-entity id="book"
                        bind-toggle__raycastable="scene == 'cabin'"
                        bind__visible="scene == 'cabin'"
                        geometry="primitive: box"
                        material="color: black"
                        position="1 1 -4"
                        tractor-beam-book
                        animation__open="startEvents: open"></a-entity>
<!--                        rotate-on-object-axis not working right now-->
        <!--    door/exit    -->
              <a-entity id="door"
                        bind-toggle__raycastable="scene == 'cabin' && bookRead"
                        bind__visible="scene == 'cabin'"
                        position="-1 1 -4"
                        rotation="90 0 0"
                        geometry="primitive: box; width: 1; height: 5; depth: 3;"
                        material="color: blue"
                        exit-handler
                        animation__open="property: rotation; to: 0 0 0; dur: 4000; easing: linear; startEvents: open"
                        animation__move="property: position; to -2 1 -5; dur: 4000; easing: linear; startEvents: move"
                        ></a-entity>
<!--Forest Scene-->
                        <a-entity light="type: ambient; color: #BBB" bind__visible="scene == 'forest'"></a-entity>
                        <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="-0.5 1 1" bind__visible="scene == 'forest'"></a-entity>
                       <a-gltf-model src="#field-glb" material="shader: flat; color: #805f40"  rotation="-90 0 0" position="9 0 9" scale="0.5 0.5      0.5" bind__visible="scene == 'forest'"></a-gltf-model>
                        <a-gltf-model id="cabin" src="#cabin-glb" material="shader: flat; color: #777"
                          scale="0.5 0.5 0.5" rotation="-90 0 0" position="9 0 9"
                          bind-toggle__raycastable="scene == 'forest' && itemsCollected" bind__visible="scene == 'forest'"
                          cabin-listener></a-gltf-model>
                        <a-gltf-model src="#mushroom-gltf" 
                          class="collidable"
                          material="color: #0f0; side: double; vertexColors: face; width: 515.72" scale="0.42 0.64 0.4" position="4.1737 2.13 -10.30248" gltf-model="https://cdn.glitch.com/142329d1-a4be-42da-8d96-ba8339c3860c%2FMushroom1.gltf?v=1560624630650"
                          tractor-beam bind__visible="scene == 'forest'"
                          ></a-gltf-model>
                        <a-entity id="death"
                                  geometry="primitive: sphere; radius: 4"
                                  position="0 2 10"
                                  material="color: #ddd"
                                  bind-toggle__raycastable="scene == 'forest'"
                                  visible="false"
                                  death-listener>
                        </a-entity>
                        

                      <a-entity position="-39 2 -35" mixin="teleport" bind-toggle__raycastable="scene == 'forest'"></a-entity>
           <a-entity position="27 2 -45" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="-2 2 -35" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
           <a-entity position="55 2 -40" mixin="teleport" bind__visible="scene == 'forest'"bind-toggle__raycastable="scene == 'forest'"></a-entity>
             <a-entity position="-38 2 -5.5" mixin="teleport" bind__visible="scene == 'forest'"bind-toggle__raycastable="scene == 'forest'"></a-entity>
            <a-entity position="-18.5 2 0" mixin="teleport" bind__visible="scene == 'forest'"bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="0 2 -20" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="15 2 -20" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="33 2 -4" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="54 2 -7" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
        <a-entity position="-38 2 17" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
        <a-entity position="-18 2 17" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="-2 2 34" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="18 2 34" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="34 2 16" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="56 2 19" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="0 2 0" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="20 2 -2" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="19 2 19" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="0 2 20" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
           <a-entity position="-38 2 51" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="-4 2 54" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="18 2 51" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
          <a-entity position="54 2 55" mixin="teleport" bind__visible="scene == 'forest'" bind-toggle__raycastable="scene == 'forest'"></a-entity>
<!--                template for game objects-->
        <a-entity id="game-objects" bind-for="for: gameObject; in: gameObjects; key: name" bind__visible="scene == 'forest'">
        <template>
          <a-entity position="{{ hotspot.position }}">
            <a-entity   position="3 2 -3" 
                        class="collidable"
                        object-lighting
                        tractor-beam 
                        set-rot-by-pos 
                        rotate-on-object-axis>
              </a-entity>
          </a-entity>
        </template>
      </a-entity>



<!--Death Scene-->



      <a-entity id="leftHand" link-controls="hand: left"></a-entity>
      <a-entity id="rightHand" link-controls="hand: right"></a-entity>
<!--       <a-plane mirror></a-plane> -->

   <!-- Camera + cursor. -->
      <a-entity id="camera" camera look-controls>
          <a-entity id="mycursor"
                    cursor="fuse: true; fuseTimeout: 2000"
                    raycaster="objects: [raycastable]"
                    position="0 0 -0.5"
                    geometry="primitive: circle; radius: 0.02"
                    material="color: #ddd; shader: flat"
                    animation="property: geometry.radius; from: 0.03; to: 0.005; dur: 2000; startEvents: changescene; pauseEvents: mouseleave">
          </a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>

<!--
//trigger a fade out and movement upon click
1. get the start button to work
2. import sound design
3. import music

//state order of operation
1. start screen state
    show hide images
    how many quests completed - 0
    lighting and fog
2. character screen state
    images
    same lighting and fog


logic

loop over every element in a scene and emit events, toggle visibility, and scale and changing scene.
maybe attach a class with the name of the scene to each element OR have a list of ids for each scene.


-->
